<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.11/index.global.min.js"></script>

<style>
:root{
  --bg:#bbbbbb;
  --text:#e5e7eb;
  --border:#1f2937;

  --fc-page-bg-color-a:#0b0f14;
  --fc-page-bg-color-b:#0e1420;
  --fc-neutral-text-color:#e5e7eb;
  --fc-border-color:#1f2937;
  --fc-today-bg-color:rgba(255,220,40,.35);
  --fc-event-text-color:#ffffff;
  --fc-event-border-color:transparent;
}

html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
}

.main{
  height:100vh;
  padding:10px;
  box-sizing:border-box;
  min-height:0;
}

#calendar{
  height:100%;
  min-height:0;
}

/* ===== 縦が短い時の縮み対応（重要） ===== */
.fc,
.fc .fc-view-harness,
.fc .fc-scroller-harness,
.fc .fc-scroller{
  min-height:0 !important;
}
.fc .fc-scroller{
  overflow:auto !important;
}

/* 見た目 */
.fc{
  background:transparent !important;
  border-radius:14px;
  overflow:hidden;
}
.fc-theme-standard td,
.fc-theme-standard th,
.fc-theme-standard .fc-scrollgrid{
  border-color:var(--fc-border-color) !important;
}

.fc .fc-toolbar-title,
.fc .fc-col-header-cell-cushion,
.fc .fc-timegrid-axis-cushion,
.fc .fc-timegrid-slot-label-cushion{
  color:var(--fc-neutral-text-color) !important;
}

.fc .fc-event{
  border:none !important;
  box-shadow:none !important;
}

.fc .fc-event-title{
  white-space:normal !important;
  font-weight:600;
}

/* 今日 */
.fc .fc-day-today,
.fc .fc-timegrid-col.fc-day-today{
  background:var(--fc-today-bg-color) !important;
}

/* 交互背景 */
.fc .fc-timegrid-col:nth-child(odd),
.fc .fc-daygrid-day:nth-child(odd){
  background:var(--fc-page-bg-color-a) !important;
}
.fc .fc-timegrid-col:nth-child(even),
.fc .fc-daygrid-day:nth-child(even){
  background:var(--fc-page-bg-color-b) !important;
}

.fc .fc-scrollgrid,
.fc .fc-scrollgrid-section,
.fc .fc-scrollgrid-section > *{
  background:transparent !important;
}

/* 設定ボタンをそれっぽく */
.fc .fc-settings-button{
  padding:0 10px !important;
  font-size:16px !important;
  line-height:1 !important;
}
</style>
</head>

<body>
<main class="main">
  <div id="calendar"></div>
</main>

<script>
/* ================= 必須 ================= */
const GOOGLE_API_KEY = "AIzaSyDZdH26P0tSEBRNnEa4rE9As7rcd924QJ4";

/* ================= カレンダー設定 ================= */
const CALENDAR_CONFIG = {
  "bonbonbon0105@gmail.com": {
    visible:true,
    showTitle:true,
    showTime:true,
    color:"#2563eb"
  },
  "q5iptcp4jeta8irgvoqtf8n5ng@group.calendar.google.com": {
    visible:true,
    showTitle:false,
    showTime:false,
    label:"予定あり",
    color:"#7c3aed"
  }
};

function buildEventSources(){
  return Object.entries(CALENDAR_CONFIG)
    .filter(([_,c])=>c.visible)
    .map(([id,c])=>({
      googleCalendarId:id,
      color:c.color,
      textColor:"#fff",
      borderColor:"transparent"
    }));
}

let calendar;
let resizeBound=false;

function rebuildCalendar(){
  if(calendar){
    calendar.destroy();
    calendar=null;
  }

  calendar = new FullCalendar.Calendar(
    document.getElementById("calendar"),
    {
      firstDay:1,
      initialView:"timeGridWeek",

      customButtons:{
        settings:{
          text:"⚙",
          click:()=>{
            alert("設定UI（ドロワー）を戻すなら言って。今はボタン復活だけ。");
          }
        }
      },

      headerToolbar:{
        left:"prev,next today",
        center:"title",
        right:"settings timeGridWeek,dayGridMonth"
      },

      height:"100%",
      expandRows:true,
      nowIndicator:true,
      slotMinTime:"06:00:00",
      slotMaxTime:"24:00:00",

      googleCalendarApiKey:GOOGLE_API_KEY,
      eventSources:buildEventSources(),

      eventDidMount:(info)=>{
        const id = info.event.source?.googleCalendarId;
        const cfg = CALENDAR_CONFIG[id];
        if(!cfg) return;

        if(cfg.showTime === false){
          info.el.querySelectorAll(".fc-event-time")
            .forEach(el=>el.textContent="");
        }

        if(cfg.showTitle === false){
          const label = cfg.label ?? "";
          const titleEl = info.el.querySelector(".fc-event-title");
          if(titleEl){
            titleEl.textContent = label;
          }
        }
      },

      eventSourceFailure:(err)=>{
        console.error("Google Calendar fetch failed:", err);
      }
    }
  );

  calendar.render();

  // settingsボタンにクラス付与（CSS当てる）
  setTimeout(()=>{
    document.querySelectorAll(".fc-settings-button")
      .forEach(btn=>btn.classList.add("fc-settings-button"));
    const btn = document.querySelector(".fc-settings-button");
    if(btn) btn.classList.add("fc-settings-button");
    // FullCalendarは customButtons 名 + "-button" が付く
    const sBtn = document.querySelector(".fc-settings-button, .fc-settings-button-button, .fc-settings-button.fc-button, .fc-settings-button-button.fc-button");
    // 上のは保険。確実なのは↓
    document.querySelectorAll(".fc-settings-button, .fc-settings-button-button").forEach(()=>{});
    const real = document.querySelector(".fc-settings-button, .fc-settings-button-button, .fc-settings-button.fc-button, .fc-settings-button-button.fc-button, .fc-settings-button-button.fc-button-primary");
    // ここは何もしない（見た目は標準でもOK）
  },0);

  if(!resizeBound){
    resizeBound=true;
    window.addEventListener("resize", ()=>{
      if(calendar) calendar.updateSize();
    });
  }
}

document.addEventListener("DOMContentLoaded", rebuildCalendar);
</script>
</body>
</html>
